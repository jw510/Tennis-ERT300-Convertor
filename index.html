<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ERT300 DT/Tension Converter</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { padding: 20px; }
    .tab-content > div { padding-top: 20px; }
    .output { font-size: 1.2em; margin-top: 20px; }
    #converter select, #converter input { margin-bottom: 15px; }
    .history-entry { font-size: 0.95em; margin-bottom: 8px; }
    .history-card { background-color: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
    .bg-dark .history-card { background-color: #2c2f33; }
  </style>
</head>
<body>
  <div class="container">
    <div class="d-flex justify-content-end mb-2">
      <label for="darkModeToggle" class="form-check-label me-2">üåô Dark Mode</label>
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="darkModeToggle">
      </div>
    </div>

    <h2 class="text-center mb-4">ERT300 DT/Tension Converter</h2>

    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item">
        <button class="nav-link active" id="how-tab" data-bs-toggle="tab" data-bs-target="#how" type="button">üìò How to Use</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="what-tab" data-bs-toggle="tab" data-bs-target="#what" type="button">üìè What is DT</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="convert-tab" data-bs-toggle="tab" data-bs-target="#converter" type="button">üßÆ Converter</button>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane fade show active" id="how">
        <p><strong>1.</strong> Clip the ERT300 in the center of the string bed (jump the widest cross string).</p>
        <p><strong>2.</strong> Hold the racket at the throat or grip, and keep it steady during measurement.</p>
        <p><strong>3.</strong> Press the ON button. A simulated ball impact starts (gentle vibrations).</p>
        <p><strong>4.</strong> Read the DT value after 6‚Äì8 seconds. The device will shut off automatically.</p>
        <p class="text-danger"><strong>Note:</strong> If ERROR appears, reposition and try again. Hold from grip if needed.</p>
      </div>

      <div class="tab-pane fade" id="what">
        <p>DT (Dynamic Tension) is the stiffness of the string bed. Higher DT = more control, lower DT = more power.</p>
        <ul>
          <li>DT 28‚Äì34: Defensive</li>
          <li>DT 35‚Äì41: Dynamic</li>
          <li>DT 42‚Äì46: Aggressive</li>
          <li>DT 47‚Äì54: Very Aggressive</li>
        </ul>
        <p>DT = kp/cm (force needed to deflect 1 cm). Measured at sweet spot.</p>
      </div>

      <div class="tab-pane fade" id="converter">
        <label for="headSize">Racket Head Size (sq. in.):</label>
        <select id="headSize" class="form-select">
          <option value="83-94">83-94</option>
          <option value="95-105">95-105</option>
          <option value="106-115">106-115</option>
        </select>
        <label for="dtInput">Enter DT Value:</label>
        <input type="number" id="dtInput" class="form-control" placeholder="Enter DT value (26-53)">
        <label for="ownerName">Owner Name:</label>
        <input type="text" id="ownerName" class="form-control" placeholder="e.g. Alex, Jason">
        <label for="racketName">Racket Name:</label>
        <input type="text" id="racketName" class="form-control" placeholder="e.g. Blade 98">
        <label for="stringType">String Type:</label>
        <input type="text" id="stringType" class="form-control" placeholder="e.g. ALU Power">
        <div id="errorMsg" class="text-danger mt-2"></div>
        <div class="output">
          <p><strong>Tension (lbs):</strong> <span id="lbsOutput">-</span></p>
          <p><strong>Tension (kg):</strong> <span id="kgOutput">-</span></p>
        </div>
        <button class="btn btn-primary mt-3" onclick="saveDT()">üíæ Save to History</button>
        
        <div class="mt-3">
          <button class="btn btn-secondary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#historyCollapse">üìú View DT History</button>
          <div class="collapse mt-3" id="historyCollapse">
            <input type="text" id="historyFilter" class="form-control mb-3" placeholder="Filter by Owner or Racket Name">
<div id="historyContent" class="border rounded p-3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const headSelect = document.getElementById('headSize');
    const dtInput = document.getElementById('dtInput');
    const ownerInput = document.getElementById('ownerName');
    const racketInput = document.getElementById('racketName');
    const stringInput = document.getElementById('stringType');
    const kgOutput = document.getElementById('kgOutput');
    const lbsOutput = document.getElementById('lbsOutput');
    const errorMsg = document.getElementById('errorMsg');
    const historyContent = document.getElementById('historyContent');
    const filterInput = document.getElementById('historyFilter');

    
const data = {
  "106-115": {
    "26": [19, 42], "27": [20, 44], "28": [20.5, 45], "29": [21, 46], "30": [22, 48],
    "31": [23, 51], "32": [23.5, 52], "33": [24, 53], "34": [24.5, 54], "35": [25, 55],
    "36": [25.5, 56], "37": [26, 57], "38": [27, 59], "39": [27.5, 60], "40": [28, 62],
    "41": [29, 64], "42": [29.5, 65], "43": [30, 66], "44": [31, 68], "45": [32, 70],
    "46": [33, 73], "47": [34, 75], "48": [35, 77], "49": [35.5, 78], "50": [36, 79],
    "51": [36.5, 79.5], "52": [37, 80], "53": [37.5, 81]
  },
  "95-105": {
    "26": [17, 37], "27": [18, 40], "28": [18.5, 41], "29": [19, 42], "30": [20, 44],
    "31": [21, 46], "32": [21.5, 47], "33": [22, 48], "34": [22.5, 49], "35": [23, 50],
    "36": [23.5, 51], "37": [24, 52], "38": [25, 54], "39": [25.5, 55], "40": [26, 57],
    "41": [27, 59], "42": [27.5, 60], "43": [28, 61], "44": [29, 63], "45": [30, 65],
    "46": [31, 67], "47": [32, 69], "48": [32.5, 70], "49": [33, 71], "50": [33.5, 72],
    "51": [34, 73], "52": [34.5, 75], "53": [35, 77]
  },
  "83-94": {
    "26": [15, 33], "27": [16, 35], "28": [16.5, 36], "29": [17, 37], "30": [18, 40],
    "31": [19, 42], "32": [19.5, 43], "33": [20, 44], "34": [20.5, 45], "35": [21, 46],
    "36": [21.5, 47], "37": [22, 48], "38": [23, 50], "39": [23.5, 51], "40": [24, 52],
    "41": [25, 54], "42": [25.5, 55], "43": [26, 56], "44": [27, 58], "45": [28, 60],
    "46": [29, 62], "47": [30, 64], "48": [30.5, 65], "49": [31, 66], "50": [31.5, 67],
    "51": [32, 68], "52": [32.5, 70], "53": [33, 74]
  }
};


    function updateOutput() {
      const headSize = headSelect.value;
      const dt = parseInt(dtInput.value);
      if (isNaN(dt) || dtInput.value.includes('.')) {
        errorMsg.textContent = "Please enter a whole number.";
        kgOutput.textContent = '-';
        lbsOutput.textContent = '-';
        return;
      }
      if (!data[headSize][dt]) {
        errorMsg.textContent = "DT value out of range. Enter a whole number between 26 and 53.";
        kgOutput.textContent = '-';
        lbsOutput.textContent = '-';
        return;
      }
      errorMsg.textContent = "";
      const [kg, lbs] = data[headSize][dt];
      kgOutput.textContent = kg;
      lbsOutput.textContent = lbs;
    }

    function saveDT() {
      const owner = ownerInput.value.trim();
      const racket = racketInput.value.trim();
      const string = stringInput.value.trim();
      const dt = parseInt(dtInput.value);
      const headSize = headSelect.value;
      const now = new Date().toLocaleString();
      if (!owner || !racket || !string || isNaN(dt)) {
        alert("Please enter Owner, Racket, String and valid DT.");
        return;
      }
      const history = JSON.parse(localStorage.getItem('dtHistory') || '{}');
      const key = `${owner}::${racket}`;
      if (!history[key]) history[key] = [];
      history[key].unshift({ dt, string, owner, headSize, time: now });
      localStorage.setItem('dtHistory', JSON.stringify(history));
      displayHistory();
    }

    function deleteEntry(key, index) {
      const history = JSON.parse(localStorage.getItem('dtHistory') || '{}');
      if (history[key]) {
        history[key].splice(index, 1);
        if (history[key].length === 0) delete history[key];
        localStorage.setItem('dtHistory', JSON.stringify(history));
        displayHistory();
      }
    }

    function displayHistory() {
      const history = JSON.parse(localStorage.getItem('dtHistory') || '{}');
      const filter = filterInput.value.toLowerCase();
      historyContent.innerHTML = '';
      for (const [key, entries] of Object.entries(history)) {
        const [owner, racket] = key.split('::');
        if (filter && !owner.toLowerCase().includes(filter) && !racket.toLowerCase().includes(filter)) continue;
        const title = document.createElement('h6');
        title.innerHTML = `üéæ <strong>${owner}</strong> ‚Äì ${racket}`;
        historyContent.appendChild(title);
        entries.forEach((entry, index) => {
          const div = document.createElement('div');
          div.className = 'history-card';
          const tension = data[entry.headSize]?.[entry.dt] || ["-", "-"];
          div.innerHTML = `
            <div><strong>DT:</strong> ${entry.dt}</div>
            <div><strong>Tension:</strong> ${tension[1]} lbs / ${tension[0]} kg</div>
            <div><strong>String:</strong> ${entry.string}</div>
            <div><strong>Head Size:</strong> ${entry.headSize}</div>
            <div><strong>Time:</strong> ${entry.time}</div>
            <div class='mt-2'><button class='btn btn-sm btn-danger' onclick='deleteEntry("${key}", ${index})'>üóë Delete</button></div>
          `;
          historyContent.appendChild(div);
        });
      }
    }

    headSelect.addEventListener('change', updateOutput);
    dtInput.addEventListener('input', updateOutput);
    filterInput.addEventListener('input', displayHistory);
    window.addEventListener('DOMContentLoaded', () => {
      updateOutput();
      displayHistory();

      const toggle = document.getElementById('darkModeToggle');
      const prefersDark = localStorage.getItem('theme') === 'dark';
      if (prefersDark) {
        document.body.classList.add('bg-dark', 'text-light');
        toggle.checked = true;
      }
      toggle.addEventListener('change', () => {
        document.body.classList.toggle('bg-dark');
        document.body.classList.toggle('text-light');
        localStorage.setItem('theme', toggle.checked ? 'dark' : 'light');
      });
    });
  </script>
</body>
</html>

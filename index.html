<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ERT300 DT/Tension Converter</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 20px; }
    .tab-content > div { padding-top: 20px; }
    .output { font-size: 1.2em; margin-top: 20px; }
    #converter select, #converter input { margin-bottom: 15px; }
    .history-entry { font-size: 0.95em; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
    .history-entry span { flex-grow: 1; }
    .delete-btn { margin-left: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="text-center mb-4">ERT300 DT/Tension Converter</h2>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="how-tab" data-bs-toggle="tab" data-bs-target="#how" type="button" role="tab">📘 How to Use</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="what-tab" data-bs-toggle="tab" data-bs-target="#what" type="button" role="tab">📏 What is DT</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="convert-tab" data-bs-toggle="tab" data-bs-target="#converter" type="button" role="tab">🧮 Converter</button>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="how" role="tabpanel">
        <p><strong>1.</strong> Clip the ERT300 in the center of the string bed (jump the widest cross string).</p>
        <p><strong>2.</strong> Hold the racket at the throat or grip, and keep it steady during measurement.</p>
        <p><strong>3.</strong> Press the ON button. A simulated ball impact starts (gentle vibrations).</p>
        <p><strong>4.</strong> Read the DT value after 6–8 seconds. The device will shut off automatically.</p>
        <p class="mt-3 text-danger"><strong>Note:</strong> If the ERROR message appears, reposition the device and try again. Hold from the grip instead of throat if needed.</p>
      </div>
      <div class="tab-pane fade" id="what" role="tabpanel">
        <p>DT (Dynamic Tension) is the stiffness of the string bed measured by the ERT300 through an electronic simulation of ball impact.</p>
        <ul>
          <li>Higher DT = More control</li>
          <li>Lower DT = More power</li>
        </ul>
        <p><strong>DT Value Ranges:</strong></p>
        <ul>
          <li>DT 28–34: Defensive Play</li>
          <li>DT 35–41: Dynamic/Offensive Play</li>
          <li>DT 42–46: Fast/Aggressive Play</li>
          <li>DT 47–54: Very Fast/Extremely Aggressive</li>
        </ul>
        <p>DT is measured in kp/cm (or Newton/mm). It represents the force needed to deflect the string bed by 1 cm at the sweet spot.</p>
      </div>
      <div class="tab-pane fade" id="converter" role="tabpanel">
        <label for="headSize">Racket Head Size (sq. in.):</label>
        <select id="headSize" class="form-select">
          <option value="83-94">83-94</option>
          <option value="95-105">95-105</option>
          <option value="106-115">106-115</option>
        </select>
        <label for="dtInput">Enter DT Value:</label>
        <input type="number" id="dtInput" class="form-control" placeholder="Enter DT value (26-53)">
        <label for="racketName">Racket Name:</label>
        <input type="text" id="racketName" class="form-control" placeholder="e.g. Wilson Blade 98">
        <label for="stringType">String Type:</label>
        <input type="text" id="stringType" class="form-control" placeholder="e.g. Luxilon ALU Power">
        <div id="errorMsg" class="text-danger mt-2"></div>
        <div class="output">
          <p><strong>Tension (kg):</strong> <span id="kgOutput">-</span></p>
          <p><strong>Tension (lbs):</strong> <span id="lbsOutput">-</span></p>
        </div>
        <button class="btn btn-primary mt-3" onclick="saveDT()">💾 Save to History</button>
        <div class="mt-4">
          <button class="btn btn-secondary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#historyCollapse">📜 View DT History</button>
          <div class="collapse mt-3" id="historyCollapse">
            <div id="historyContent" class="border rounded p-3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const data = {
      "106-115": { "26": [19, 42], "27": [20, 44], "28": [20.5, 45], "29": [21, 46], "30": [22, 48], "31": [23, 51], "32": [23.5, 52], "33": [24, 53], "34": [24.5, 54], "35": [25, 55], "36": [25.5, 56], "37": [26, 57], "38": [27, 59], "39": [27.5, 60], "40": [28, 62], "41": [29, 64], "42": [29.5, 65], "43": [30, 66], "44": [31, 68], "45": [32, 70], "46": [33, 73], "47": [34, 75], "48": [35, 77], "49": [35.5, 78], "50": [36, 79], "51": [36.5, 79.5], "52": [37, 80], "53": [37.5, 81] },
      "95-105": { "26": [17, 37], "27": [18, 40], "28": [18.5, 41], "29": [19, 42], "30": [20, 44], "31": [21, 46], "32": [21.5, 47], "33": [22, 48], "34": [22.5, 49], "35": [23, 50], "36": [23.5, 51], "37": [24, 52], "38": [25, 54], "39": [25.5, 55], "40": [26, 57], "41": [27, 59], "42": [27.5, 60], "43": [28, 61], "44": [29, 63], "45": [30, 65], "46": [31, 67], "47": [32, 69], "48": [32.5, 70], "49": [33, 71], "50": [33.5, 72], "51": [34, 73], "52": [34.5, 75], "53": [35, 77] },
      "83-94": { "26": [15, 33], "27": [16, 35], "28": [16.5, 36], "29": [17, 37], "30": [18, 40], "31": [19, 42], "32": [19.5, 43], "33": [20, 44], "34": [20.5, 45], "35": [21, 46], "36": [21.5, 47], "37": [22, 48], "38": [23, 50], "39": [23.5, 51], "40": [24, 52], "41": [25, 54], "42": [25.5, 55], "43": [26, 56], "44": [27, 58], "45": [28, 60], "46": [29, 62], "47": [30, 64], "48": [30.5, 65], "49": [31, 66], "50": [31.5, 67], "51": [32, 68], "52": [32.5, 70], "53": [33, 74] }
    };
    const headSelect = document.getElementById('headSize');
    const dtInput = document.getElementById('dtInput');
    const racketInput = document.getElementById('racketName');
    const stringInput = document.getElementById('stringType');
    const kgOutput = document.getElementById('kgOutput');
    const lbsOutput = document.getElementById('lbsOutput');
    const errorMsg = document.getElementById('errorMsg');
    const historyContent = document.getElementById('historyContent');
    function updateOutput() {
      const headSize = headSelect.value;
      const dt = parseInt(dtInput.value);
      if (isNaN(dt) || dtInput.value.includes('.')) {
        errorMsg.textContent = "Please enter a whole number.";
        kgOutput.textContent = '-';
        lbsOutput.textContent = '-';
        return;
      }
      if (!data[headSize] || !data[headSize][dt]) {
        errorMsg.textContent = "DT value out of range. Enter a whole number between 26 and 53.";
        kgOutput.textContent = '-';
        lbsOutput.textContent = '-';
        return;
      }
      errorMsg.textContent = "";
      const [kg, lbs] = data[headSize][dt];
      kgOutput.textContent = kg;
      lbsOutput.textContent = lbs;
    }
    function saveDT() {
      const racket = racketInput.value.trim();
      const string = stringInput.value.trim();
      const dt = parseInt(dtInput.value);
      const headSize = headSelect.value;
      const now = new Date().toLocaleString();
      if (!racket || !string || isNaN(dt)) {
        alert("Please enter valid Racket Name, String Type, and DT value within range.");
        return;
      }
      const history = JSON.parse(localStorage.getItem('dtHistory') || '{}');
      if (!history[racket]) history[racket] = [];
      history[racket].unshift({ dt, string, headSize, time: now });
      localStorage.setItem('dtHistory', JSON.stringify(history));
      displayHistory();
    }
    function deleteEntry(racket, index) {
      const history = JSON.parse(localStorage.getItem('dtHistory') || '{}');
      if (history[racket]) {
        history[racket].splice(index, 1);
        if (history[racket].length === 0) delete history[racket];
        localStorage.setItem('dtHistory', JSON.stringify(history));
        displayHistory();
      }
    }
    function displayHistory() {
      const history = JSON.parse(localStorage.getItem('dtHistory') || '{}');
      historyContent.innerHTML = '';
      for (const [racket, entries] of Object.entries(history)) {
        const title = document.createElement('h6');
        title.textContent = `🎾 ${racket}`;
        historyContent.appendChild(title);
        entries.forEach((entry, index) => {
          const div = document.createElement('div');
          div.className = 'history-entry';
          div.innerHTML = `<span>DT: ${entry.dt} | String: ${entry.string} | Head: ${entry.headSize} | Time: ${entry.time}</span><button class='btn btn-sm btn-danger delete-btn' onclick='deleteEntry("${racket}", ${index})'>🗑️</button>`;
          historyContent.appendChild(div);
        });
      }
    }
    headSelect.addEventListener('change', updateOutput);
    dtInput.addEventListener('input', updateOutput);
    window.addEventListener('DOMContentLoaded', displayHistory);
  </script>
</body>
</html>
